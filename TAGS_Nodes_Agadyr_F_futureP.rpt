{"top":0,"left":0,"width":1914,"height":1500,"_id":115,"_type":"Report","_items":{"5":{"top":112,"left":892,"_id":5,"_type":"Button","width":110.00000000000001,"height":40,"text":"Запросить\nпрогноз","background_color":"#bcbcbc","border_width":2,"z_index":2,"enabled":false,"_events":{"click":{"type":"SCRIPT","value":{"tags":{"value":["/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/model_control","trigger"]},"script":"function(VARS,element,context){\r    var trigger;\r    trigger = VARS.value.get();\r    if (trigger == null)\r        {\r           trigger = 1; \r        }\r    else {\r        trigger = trigger + 1;\r    }\r    console.log(trigger)\r\tVARS.value.set(trigger);\r\t\r\tcontext.setTimeout(()=>{\r\t    context.run_report();\r\t}, 30000);\r}"}}}},"48":{"top":815,"left":823,"_id":48,"_type":"LocalDatasource","_links":{"data":{"type":"SCRIPT","tags":{"DS":[{"source":"ts"}]},"script":"function(VARS, element, context) {\n    let ds = VARS.DS.data();\n    console.log(\"DEBUG:typeof ds:\",typeof ds);\n    console.log(\"DEBUG:ds:\",ds);\n    console.log(\"DEBUG:ds[0]:\",ds[0]);\n    \n    let arrayMean = function (arr) {\n        return arr.reduce((a, b) => a + b, 0) / arr.length;\n    };\n    \n    // Functions to find RMSE\n    let RootMeanSquareError = function (fact, predict) {\n        let valueArray = fact.map(\n            function (v, i) {\n                return Math.pow((v - predict[i]), 2);\n            });\n        return Math.sqrt(valueArray.reduce((a, x) => (a + x), 0)) / valueArray.length;\n    };\n    \n    // Functions to find MAE\n    let meanAbsErrorPer = function (fact, predict) {\n        let valueArray = fact.map(\n            function (v, index) {\n                return Math.abs(v - predict[index]) / v;\n            });\n        return ( valueArray.reduce((acc, value) => (acc + value)) / valueArray.length ) * 100;\n    };\n    \n    // Functions to find std\n    let standDev = function (arr) {\n        let valueMean = arr.reduce((acc, b) => acc + b, 0) / arr.length;\n        return Math.sqrt(arr.reduce((acc, x) => (acc + Math.pow(x - valueMean, 2))) / arr.length);\n    };\n    \n    // Functions to find minV\n    let minValue = function (arr) {\n        return Math.min.apply(null, arr);\n    };\n    \n    let maxValue = function (arr) {\n        return Math.max.apply(null, arr);\n    };\n    \n    // Prepare array of parameter with numbers\n    let p_fact = ds.map((value) => {\n        //return value.p_load_fact_smooth;\n        return value.FACT;\n    });\n    let p_predict = ds.map((value) => {\n        //return value.predict_p_load;\n        return value.PRED;\n    });\n\n    let date = ds.map((value) => {\n        return value.date;\n    });\n\n    var value = {};\n    \n    value.predictMinValue = Math.round(minValue(p_predict));\n    value.predictMaxValue = Math.round(maxValue(p_predict));\n    \n    value.rmse = Math.round(RootMeanSquareError(p_fact, p_predict));\n    value.maep = Math.round(meanAbsErrorPer(p_fact, p_predict));\n    \n    value.factMean = Math.round(arrayMean(p_fact));\n    value.predictMean = Math.round(arrayMean(p_predict));\n    // value.factStandDev = standDev(p_fact, value.factMean);\n    value.predictStandDev = Math.round(standDev(p_predict));\n    value.date = date[0];\n    \n    console.log('DEBUG:calculation:value ' + value);\n    //console.log('DEBUG:calculation:p_predict ' + p_predict);\n    //console.log('DEBUG:calculation:value.predictMinValue ' + value.predictMinValue);\n    \n  return [value];\n}"}},"name":"calculation","width":85,"height":40,"z_index":2,"_events":{}},"59":{"top":724,"left":3,"_id":59,"_type":"Rectangle","width":1001,"border_width":3,"border_color":"#bcbcbc","border_style":"ridge","background_color":"#f4f4f4","text":"Оценка прогнозирования","font_family":"system-ui","font_size":16,"horizontal_align":"left","padding_left":4,"_events":{}},"62":{"top":870,"_id":62,"_type":"Rectangle","width":1000,"border_width":3,"border_color":"#bcbcbc","border_style":"ridge","background_color":"#f4f4f4","text":"Реактив","font_family":"system-ui","font_size":16,"horizontal_align":"left","padding_left":2,"visible":false,"left":5,"_events":{}},"63":{"top":160,"left":5,"_id":63,"_type":"Trend","width":1000,"height":554,"select_archives":false,"set_period":false,"datasource":"trend","series":[{"name":"FACT","axis":"y"},{"name":"PRED","axis":"y"}],"border_width":2,"toolbar_visible":"roll up","_events":{}},"72":{"top":780,"left":5,"_id":72,"_type":"Grid","datasource":"calculation","config":"{\n  \"columns\": [\n    {\n      \"field\": \"date\",\n      \"title\": \"Дата\"\n    },\n    {\n      \"field\": \"predictMinValue\",\n      \"title\": \"Мин\"\n    },\n    {\n      \"field\": \"predictMaxValue\",\n      \"title\": \"Макс\"\n    },\n    {\n      \"field\": \"predictMean\",\n      \"title\": \"Среднее значение\"\n    },\n    {\n      \"field\": \"predictStandDev\",\n      \"title\": \"Станд. откл.\"\n    },\n    {\n      \"field\": \"rmse\",\n      \"title\": \"Оценка RMSE\"\n    },\n    {\n      \"field\": \"maep\",\n      \"title\": \"Оценка MAPE\"\n    }\n  ]\n}","width":1000,"height":88,"_events":{}},"103":{"top":107,"left":5,"_id":103,"_type":"Rectangle","width":1001,"border_width":3,"border_color":"#bcbcbc","border_style":"ridge","background_color":"#f4f4f4","text":"Прогноз на 36 часов","font_family":"system-ui","font_size":16,"horizontal_align":"left","padding_left":4,"_events":{}},"107":{"top":115,"left":1016,"_id":107,"_type":"JSONSource","name":"_config","value":"{\n    \"0\":{\n        \"point\":\"Agadyr_F/u220\",\n        \"ts\":[\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesS/p_load_sc\",\"name\": \"FACT\",\"aggregate\": \"mean\"},\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/futureP/predict_p_load_sc\",\"name\": \"PRED\",\"aggregate\": \"mean\"}\n        ]\n    },\n    \"1\":{\n        \"point\":\"Shymkent_F/u220\",\n        \"ts\":[\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Shymkent_F/u220/archivesS/p_load_sc\",\"name\": \"FACT\",\"aggregate\": \"mean\"},\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Shymkent_F/u220/futureP/predict_p_load_sc\",\"name\": \"PRED\",\"aggregate\": \"mean\"}\n        ]\n    }\n    \n    //\n}","_events":{}},"108":{"top":171,"left":1016,"_id":108,"_type":"JSONSource","_links":{"value":{"type":"SCRIPT","tags":{"config":[{"source":"_config"}],"point":[{"filter":"point"}]},"script":"function(VARS,element,context){\n    let config=VARS.config.data();\n    let selectedConfig = config[VARS.point.get()];\n    console.log(\"selected config: \",selectedConfig);\n    return selectedConfig;\n}"}},"name":"config","value":"{\n    \"0\":{\n        \"point\":\"Agadyr_F/u220\",\n        \"ts\":[\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesS/p_load_sc\",\"name\": \"FACT\",\"aggregate\": \"mean\"},\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/futureP/predict_p_load_sc\",\"name\": \"PRED\",\"aggregate\": \"mean\"}\n        ]\n    },\n    \"1\":{\n        \"point\":\"Shymkent_F/u220\",\n        \"ts\":[\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Shymkent_F/u220/archivesS/p_load_sc\",\"name\": \"FACT\",\"aggregate\": \"mean\"},\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Shymkent_F/u220/futureP/predict_p_load_sc\",\"name\": \"PRED\",\"aggregate\": \"mean\"}\n        ]\n    }\n    \n    //\n}","_events":{}},"109":{"top":226,"left":1016,"_id":109,"_type":"TS_Datasource","archives":[],"from":"from","to":"to","name":"ts","step":"hour","step_factor":1,"height":41,"z_index":2,"_links":{"step":{"type":"SCRIPT","tags":{"step":[{"filter":"step"}]},"script":"function(VARS,element,context){\n   // console.log(\"DEBUG: (predict) step is \",VARS.step.get(), typeof VARS.step.get());\n   return VARS.step.get();\n}","map":{"0":"hour","1":"minute"}},"archives":{"type":"SCRIPT","tags":{"config":[{"source":"config"}]},"script":"function(VARS,element,context){\n    let data=VARS.config.data();\n    if (data===undefined){ return undefined; }\n    //console.log(\"DEBUG->ts->data_config:\",data);\n    //console.log(\"DEBUG->ts->data_ts:\",data.ts);\n    return data.ts;\n}\n"}},"_events":{}},"110":{"top":271,"left":1016,"_id":110,"_type":"JSONSource","_links":{"value":{"type":"SCRIPT","tags":{"ts":[{"source":"ts"}],"point":[{"filter":"point"}]},"script":"function(VARS,element,context){\n   var value;\n   //value = VARS.my_var.get();\n   return value;\n}"}},"name":"forecast","value":"{\n    \"0\":{\n        \"point\":\"Agadyr_F/u220\",\n        \"ts\":[\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesS/p_load_sc\",\"name\": \"FACT\",\"aggregate\": \"mean\"},\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/futureP/predict_p_load_sc\",\"name\": \"PRED\",\"aggregate\": \"mean\"}\n        ]\n    },\n    \"1\":{\n        \"point\":\"Shymkent_F/u220\",\n        \"ts\":[\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Shymkent_F/u220/archivesS/p_load_sc\",\"name\": \"FACT\",\"aggregate\": \"mean\"},\n            {\"archive\":\"/root/PROJECT/TAGS/Nodes/Shymkent_F/u220/futureP/predict_p_load_sc\",\"name\": \"PRED\",\"aggregate\": \"mean\"}\n        ]\n    }\n    \n    //\n}","_events":{}},"112":{"top":329,"left":1016,"_id":112,"_type":"LocalDatasource","_links":{"data":{"type":"SCRIPT","tags":{"ts":[{"source":"ts"}]},"script":"function(VARS,element,context){\n    // console.log(VARS)\n    let ts=VARS.ts.data();\n    console.log(\"TS_DS:\",ts);\n    // let result = ts.periods.map( p => {\n\t   // p.name=moment(p.date).format(format);\n\t   // return p;\n    // });\n    \n\treturn ts;\n}"}},"name":"trend","_events":{}},"@filter":{"_id":"@filter","_type":"Filter","height":105,"_items":{"20":{"left":348,"_id":20,"_type":"DateTimePicker","z_index":1,"name":"from","top":7,"width":270,"interval":60,"_links":{"value":{"type":"SCRIPT","tags":{"factor":[{"filter":"factor"}]},"script":"function(VARS,element,context){\n   let factor = parseInt(VARS.factor.get());\n   return +new Date() - factor * 24 * 3600 * 1000; //to ms\n}"}},"_events":{"init":{"type":"SCRIPT","value":{"script":"function(VARS,element,context){\r    element.set({value: +new Date() - 48 * 3600000});\r    // context.setInterval(()=>{\r    //     element.set({value: +new Date() - 48 * 3600000});\r    // },5000);\r}"}}}},"22":{"left":694,"_id":22,"_type":"DateTimePicker","z_index":1,"name":"to","_links":{"value":{"type":"SCRIPT","tags":{"from":[{"filter":"from"}]},"script":"function(VARS,element,context){\n    //VARS.from.get()\n    let toDate = +new Date() + 48 * 3600000;\n    return toDate;\n}"}},"width":270,"top":7,"_events":{}},"28":{"left":649,"_id":28,"_type":"Rectangle","width":55,"height":35,"z_index":1,"border_width":0,"transparent":true,"text":"по:","font_family":"system-ui","font_size":16,"top":7,"_events":{}},"68":{"left":1648,"_id":68,"_type":"DateTimePicker","z_index":1,"name":"now1","_links":{"value":{"type":"SCRIPT","tags":{"from":[{"filter":"from"}]},"script":"function(VARS,element,context){\n   let d = new Date();\n   //console.log(d);\n   //return +new Date(VARS.from.get()) + 96 * 3600000;\n   return d;\n}"}},"width":240,"top":11,"_events":{}},"74":{"left":1648,"_id":74,"_type":"DateTimePicker","z_index":1,"name":"now2","_links":{"value":{"type":"SCRIPT","tags":{"from":[{"filter":"from"}]},"script":"function(VARS,element,context){\n   let d = new Date();\n   //console.log(d);\n   //return +new Date(VARS.from.get()) + 96 * 3600000;\n   return d;\n}"}},"width":240,"top":57,"_events":{}},"75":{"_id":75,"_type":"Rectangle","width":55,"height":35,"z_index":1,"border_width":0,"transparent":true,"text":"От:","font_family":"system-ui","font_size":16,"top":7,"left":303,"_events":{}},"78":{"top":7,"left":76,"_id":78,"_type":"Combobox","width":235,"z_index":1,"name":"point","options":["Agadyr_F/u220","Shymkent_F/u220"],"_links":{"options":{"type":"SCRIPT","script":"function(VARS,element,context){\n   \n   let options = [\n       \"Agadyr_F/u220\",\n       \"Shymkent_F/u220\",\n       \"ATETS-3_F/u110\",\n       \"Agadyr_F/u220\",\n       \"Alma_F/u220\",\n       \"Almaty_F/u220\",\n       \"Aspara_220_F\",\n       \"Avrora_F\",\n       \"Balkhashskaya_F/u110\",\n       \"Barabinskaya_F\",\n       \"Barnaul_F\",\n       \"CA-1_F\",\n       \"CGPP_F/u220\",\n       \"Cheliabinsk_F\",\n       \"EEC_F\",\n       \"EEC_F/u220\",\n       \"EGRES-1_F/u20\",\n       \"EGRES-1_F/u220\",\n       \"EGRES-2_F/u20\",\n       \"Frunze_F/u220\",\n       \"Glavnaya_220_F\",\n       \"IrGRES_F\",\n       \"Irtyshskaya_F\",\n       \"Kar.GRES-2_F/u110\",\n       \"Karazhal_220_F\",\n       \"Kemin_220_F\",\n       \"Kentau_F\",\n       \"Kokshetau_F\",\n       \"Kostanai_F\",\n       \"Koyan-Kos_220_F\",\n       \"Kozirevo_F\",\n       \"Kumkol_220_F/u110\",\n       \"Kurgan_F\",\n       \"Kyzylorda_220_F\",\n       \"MagnitRF_F\",\n       \"Medeo_220_F\",\n       \"Mirgalimsai_F\",\n       \"MoinakGES_220_F\",\n       \"Mointy_220_F\",\n       \"Nura_F/u220\",\n       \"Oskarovka-220_F\",\n       \"PS-EGPP_F\",\n       \"PS7-AHBK_F/u110\",\n       \"Robot_F\",\n       \"Ru-6_F\",\n       \"Rubtsovsk_F\",\n       \"Semey_F/u220\",\n       \"Shagol_F\",\n       \"Shilik_220_F\",\n       \"Shu_F/u220\",\n       \"Shymkent_F/u220\",\n       \"Shymkentskaya_F\",\n       \"Sibir_F\",\n       \"Sistema-Ural_F\",\n       \"Sokol_F\",\n       \"Taldykorgan_F/u220\",\n       \"TashGRES_F\",\n       \"TashGRES_F/u220\",\n       \"Tashkent_F\",\n       \"Tavricheskaya_F\",\n       \"TrGRES_F\",\n       \"UKGRES_F/u220\",\n       \"UjUrGRES_F\",\n       \"Usti-Kamenogorsk_F/u220\",\n       \"VityazRF_F\",\n       \"VoshodRF_F\",\n       \"Zapadnaya_220_F\",\n       \"Zarya_F\",\n       \"ZhGRES_220_F\",\n       \"Zhambyl_F/u220\",\n       \"Zhanakorgan_F\",\n       \"Zhezkazgan_F/u220\",\n       \"Zhylga_220_F\",\n       \"pu_Almaty_Alma_F\",\n       \"pu_CGPP_EGRES-1_F\",\n       \"pu_CGPP_Oskarovka_F\",\n       \"pu_EEC_Semey_F\",\n       \"pu_EGRES-1_EEC_F\",\n       \"pu_EGRES-1_Oskarovka_F\",\n       \"pu_Frunze_Kemin_F\",\n       \"pu_GNPS_F\",\n       \"pu_Glavnaya_Frunze_F\",\n       \"pu_Glavnaya_Kemin_F\",\n       \"pu_KarGRES_Agadyr_F\",\n       \"pu_KarGRES_Balkhashskaya_F\",\n       \"pu_KarGRES_Karazhal_F\",\n       \"pu_KarGRES_Nura_F\",\n       \"pu_KarGRES_Oskarovka_F\",\n       \"pu_Kentau_Zhambyl_220_F\",\n       \"pu_Kyzylorda_Kumkol_F\",\n       \"pu_Mointy_UkGRES_F\",\n       \"pu_Ru-6_Kyzylorda_F\",\n       \"pu_Semey_U-K_F\",\n       \"pu_Shymkent_220_Zhylga_F\",\n       \"pu_Taldykorgan_Robot_F\",\n       \"pu_UkGRES_Shu_F\",\n       \"pu_ZhGRES_Frunze_F\",\n       \"pu_Zhambyl_Shymkent_F\",\n       \"pu_Zhezkazgan_Karazhal_F\"\n   ];\n   \n   //console.log(\"DEBUG:point:element: \", element);\n   \n   return options;\n}"}},"required":true,"_events":{}},"81":{"_id":81,"_type":"Rectangle","width":71,"height":35,"z_index":1,"border_width":0,"transparent":true,"text":"Объект:","font_family":"system-ui","font_size":16,"top":7,"left":8,"horizontal_align":"left","padding_left":2,"bold":true,"_events":{}},"104":{"top":7,"left":1092,"_id":104,"_type":"Combobox","width":70,"z_index":1,"name":"step","options":["час","мин"],"_events":{}},"105":{"_id":105,"_type":"Rectangle","width":109,"height":35,"z_index":1,"border_width":0,"transparent":true,"text":"Выбор шага:","font_family":"system-ui","font_size":16,"top":7,"left":985,"horizontal_align":"left","padding_left":2,"title":"Шаг дискретизации данных трендов","_events":{}},"113":{"top":55,"left":348,"_id":113,"_type":"Slider","width":617,"z_index":1,"title":"на сколько дней назад получить архив?","name":"factor","value":1,"min":1,"max":30,"small_step":1,"large_step":5,"_events":{}},"114":{"_id":114,"_type":"Rectangle","width":82,"height":35,"z_index":1,"border_width":0,"transparent":true,"text":"Фактор:","font_family":"system-ui","font_size":16,"top":50,"left":269,"horizontal_align":"left","padding_left":2,"bold":true,"_events":{}},"115":{"top":9,"left":1181,"_id":115,"_type":"Button","width":198,"z_index":1,"text":"Сформировать отчет","bold":true,"_events":{"click":{"type":"SCRIPT","value":{"script":"function(VARS,element,context){\r    // let now=+(new Date());\r    // let from=+(new Date(VARS.from.get()));\r    // if (from>=now){\r    //     return fp_dev.error(fp_dev.text(\"Отчет не может быть сформирован за будущее число.\\r\\nПожалуйста скореектируйте параметры\"))\r    // }\r    console.log(\"Clicked - run_report()\");\r\tcontext.run_report();\r}"}}}}},"border_width":2,"border_color":"#bcbcbc","border_style":"ridge","_events":{}}},"_index":{"5":[],"20":["@filter"],"22":["@filter"],"28":["@filter"],"48":[],"59":[],"62":[],"63":[],"68":["@filter"],"72":[],"74":["@filter"],"75":["@filter"],"78":["@filter"],"81":["@filter"],"103":[],"104":["@filter"],"105":["@filter"],"107":[],"108":[],"109":[],"110":[],"112":[],"113":["@filter"],"114":["@filter"],"115":["@filter"],"@filter":[]},"background_color":"#f4f4f4","border_width":2,"border_color":"#bcbcbc","border_style":"ridge","_events":{}}