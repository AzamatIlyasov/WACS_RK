{"top":0,"left":0,"width":1914,"height":1500,"_id":106,"_type":"Report","_items":{"5":{"top":112,"left":892,"_id":5,"_type":"Button","width":110.00000000000001,"height":40,"text":"Запросить\nпрогноз","background_color":"#bcbcbc","border_width":2,"z_index":2,"_events":{"click":{"type":"SCRIPT","value":{"tags":{"value":["/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/model_control","trigger"]},"script":"function(VARS,element,context){\r    var trigger;\r    trigger = VARS.value.get();\r    if (trigger == null)\r        {\r           trigger = 1; \r        }\r    else {\r        trigger = trigger + 1;\r    }\r    console.log(trigger)\r\tVARS.value.set(trigger);\r\t\r\tcontext.setTimeout(()=>{\r\t    context.run_report();\r\t}, 30000);\r}"}}}},"48":{"top":805,"left":875,"_id":48,"_type":"LocalDatasource","_links":{"data":{"type":"SCRIPT","tags":{"DS":[{"source":"history"}]},"script":"function(VARS, element, context) {\n    \n    let ds = VARS.DS.data();\n    \n    console.log(ds[0])\n    \n    let arrayMean = function (arr) {\n           return arr.reduce((a, b) => a + b, 0) / arr.length;\n    };\n    \n    // Functions to find RMSE\n    let RootMeanSquareError = function (fact, predict) {\n            var valueArray = fact.map(\n                    function (v, i) {\n                            return Math.pow((v - predict[i]), 2);\n                    })\n            return Math.sqrt(valueArray.reduce((a, x) => (a + x), 0)) / valueArray.length;\n    };\n    \n    // Functions to find MAE\n    let meanAbsErrorPer = function (fact, predict) {\n            \n            var valueArray = fact.map(\n                    function (v, index) {\n                            return Math.abs(v - predict[index]) / v;\n                    })\n            return ( valueArray.reduce((acc, value) => (acc + value)) / valueArray.length ) * 100\n    }\n    \n    let standDev = function (arr) {\n    \n            var valueMean = arr.reduce((acc, b) => acc + b, 0) / arr.length;\n    \n            return Math.sqrt(arr.reduce((acc, x) => (acc + Math.pow(x - valueMean, 2))) / arr.length);\n    \n    };\n            \n    let minValue = function (arr) {\n    return Math.min.apply(null, arr);\n    };\n    \n    let maxValue = function (arr) {\n    return Math.max.apply(null, arr);\n    };\n    \n    // Prepare array of parameter with numbers\n    let p_fact = ds.map((value) => {\n            return value.p_load_fact_smooth;\n    });\n    let p_predict = ds.map((value) => {\n            return value.predict_p_load;\n    });\n\n    let date = ds.map((value) => {\n            return value.date;\n    });\n\n    var value = {};\n    \n    value.predictMinValue = Math.round(minValue(p_predict));\n    value.predictMaxValue = Math.round(maxValue(p_predict));\n    \n    value.rmse = Math.round(RootMeanSquareError(p_fact, p_predict));\n    value.maep = Math.round(meanAbsErrorPer(p_fact, p_predict));\n    \n    value.factMean = Math.round(arrayMean(p_fact));\n    value.predictMean = Math.round(arrayMean(p_predict));\n    // value.factStandDev = standDev(p_fact, value.factMean);\n    value.predictStandDev = Math.round(standDev(p_predict));\n    value.date = date[0];\n    \n    console.log('DEBUG:calculation' + value);\n\n  return [value];\n}"}},"name":"calculation","width":85,"height":40,"z_index":2,"_events":{}},"58":{"top":170,"left":660,"_id":58,"_type":"TS_Datasource","archives":[{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesP/p_load_sc","name":"p_load_fact_smoth","aggregate":"avg"},{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/futureP/predict_p_load_sc","name":"p_load_predict","aggregate":"avg"},{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesS/p_load_sc","name":"p_load_fact","aggregate":"avg"}],"from":"from","to":"to","name":"display","step":"hour","step_factor":1,"width":90,"height":35,"z_index":2,"_links":{"step":{"type":"SCRIPT","tags":{"step":[{"filter":"step"}]},"script":"function(VARS,element,context){\n    console.log(\"DEBUG: (predict) step is \",VARS.step.get(), typeof VARS.step.get());\n   return VARS.step.get();\n}","map":{"0":"hour","1":"minute"}}},"_events":{}},"59":{"top":418,"left":5,"_id":59,"_type":"Rectangle","width":1001,"border_width":3,"border_color":"#bcbcbc","border_style":"ridge","background_color":"#f4f4f4","text":"Оценка прогнозирования","font_family":"system-ui","font_size":16,"horizontal_align":"left","padding_left":4,"visible":false,"_events":{}},"60":{"top":472,"_id":60,"_type":"Trend","width":1000,"height":305,"select_archives":false,"set_period":false,"datasource":"history","series":[{"name":"predict_p_load","axis":"y"},{"name":"p_load_fact_smooth","axis":"y"},{"name":"p_load_fact","axis":"y"}],"left":6,"_events":{}},"61":{"top":925,"_id":61,"_type":"Trend","width":1000,"height":305,"select_archives":false,"set_period":false,"datasource":"data","series":[{"name":"predict_q_gen","axis":"y","color":"#c9252d"},{"name":"q_gen_fact","axis":"y","color":"#0d66d0"},{"name":"q_gen_fact_smooth","axis":"y","color":"#6767ec"},{"name":"predict_q_load","axis":"y","color":"#ec5b62"},{"name":"q_load_fact","axis":"y","color":"#c038cc"},{"name":"q_load_fact_smooth","axis":"y","color":"#12805c"}],"left":5,"visible":false,"_events":{}},"62":{"top":870,"_id":62,"_type":"Rectangle","width":1000,"border_width":3,"border_color":"#bcbcbc","border_style":"ridge","background_color":"#f4f4f4","text":"Реактив","font_family":"system-ui","font_size":16,"horizontal_align":"left","padding_left":2,"visible":false,"left":5,"_events":{}},"63":{"top":160,"left":5,"_id":63,"_type":"Trend","width":1000,"height":255,"select_archives":false,"set_period":false,"datasource":"display","series":[{"name":"p_load_fact","axis":"y"},{"name":"p_load_predict","axis":"y"},{"name":"p_load_fact_smoth","axis":"y"}],"border_width":2,"toolbar_visible":"hide","_events":{}},"65":{"top":438,"left":685,"_id":65,"_type":"TS_Datasource","archives":[{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/futureP/predict_p_load_sc","name":"predict_p_load","aggregate":"avg"},{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesP/p_load_sc","name":"p_load_fact_smooth","aggregate":"avg"}],"from":"from","to":"now1","name":"history","step":"hour","step_factor":1,"width":90,"height":40,"z_index":2,"_links":{"step":{"type":"SCRIPT","tags":{"step":[{"filter":"step"}]},"script":"function(VARS,element,context){\n    console.log(\"DEBUG: step is \",VARS.step.get(), typeof VARS.step.get());\n   return VARS.step.get();\n}","map":{"0":"hour","1":"minute"}}},"_events":{}},"72":{"top":780,"left":5,"_id":72,"_type":"Grid","datasource":"calculation","config":"{\n  \"columns\": [\n    {\n      \"field\": \"date\",\n      \"title\": \"Дата\"\n    },\n    {\n      \"field\": \"predictMinValue\",\n      \"title\": \"Мин\"\n    },\n    {\n      \"field\": \"predictMaxValue\",\n      \"title\": \"Макс\"\n    },\n    {\n      \"field\": \"predictMean\",\n      \"title\": \"Среднее значение\"\n    },\n    {\n      \"field\": \"predictStandDev\",\n      \"title\": \"Станд. откл.\"\n    },\n    {\n      \"field\": \"rmse\",\n      \"title\": \"Оценка RMSE\"\n    },\n    {\n      \"field\": \"maep\",\n      \"title\": \"Оценка MAPE\"\n    }\n  ]\n}","width":1000,"height":88,"_events":{}},"73":{"top":1245,"left":910,"_id":73,"_type":"TS_Datasource","archives":[{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesP/p_load_sc","name":"p_load_fact_smoth","aggregate":"avg"},{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/futureP/predict_p_load_sc","name":"p_load_predict","aggregate":"avg"},{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesS/p_load_sc","name":"p_load_fact","aggregate":"avg"}],"from":"from","to":"to","name":"data_to_model","step":"minute","step_factor":1,"width":90,"height":40,"_events":{}},"76":{"top":140,"left":1010,"_id":76,"_type":"Trend","width":900,"height":185,"select_archives":false,"set_period":false,"datasource":"display","series":[{"name":"p_load_fact_smoth","axis":"y"}],"title":"Yearly","border_width":2,"toolbar_visible":"hide","max_points":365,"cycle":24,"_events":{}},"77":{"top":145,"left":1015,"_id":77,"_type":"TS_Datasource","archives":[{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesS/p_load_sc","name":"p_load_fact","aggregate":"avg"}],"from":"from","to":"to","name":"dynamic","step":"minute","step_factor":1,"width":90,"height":35,"z_index":2,"_events":{}},"82":{"top":170,"left":755,"_id":82,"_type":"LocalDatasource","_links":{"data":{"type":"SCRIPT","tags":{"DS":[{"source":"display"}],"name":[{"filter":"selector"}]},"script":"function(VARS,element,context){\n    \n   let ds = VARS.DS.data();\n   \n   var selector;\n   selector = VARS.name.get();\n   \n//   console.log('ds' + ds[0]);\n   console.log('selector' + selector);\n}"}},"width":90,"height":35,"name":"object","_events":{}},"83":{"top":110,"left":1010,"_id":83,"_type":"Rectangle","width":205,"height":25,"border_width":0,"transparent":true,"text":"Динамика изменения за год","horizontal_align":"left","font_family":"system-ui","font_size":14,"_events":{}},"95":{"_id":95,"top":750,"left":1010,"width":900,"height":205,"_items":{"96":{"top":30,"left":0,"_id":96,"_type":"Trend","width":900,"height":175,"select_archives":false,"set_period":false,"datasource":"display","series":[{"name":"p_load_fact_smoth","axis":"y"}],"title":"Yearly","border_width":2,"toolbar_visible":"hide","max_points":365,"cycle":24,"_events":{}},"97":{"top":0,"left":0,"_id":97,"_type":"Rectangle","width":120,"height":25,"border_width":0,"transparent":true,"text":"Неделя","horizontal_align":"left","font_family":"system-ui","font_size":14,"_events":{}}},"_type":"Group","_events":{}},"98":{"_id":98,"top":540,"left":1010,"width":900,"height":205,"_items":{"92":{"top":30,"left":0,"_id":92,"_type":"Trend","width":900,"height":175,"select_archives":false,"set_period":false,"datasource":"display","series":[{"name":"p_load_fact_smoth","axis":"y"}],"title":"Yearly","border_width":2,"toolbar_visible":"hide","max_points":365,"cycle":24,"_events":{}},"93":{"top":0,"left":0,"_id":93,"_type":"Rectangle","width":120,"height":25,"border_width":0,"transparent":true,"text":"Месяц","horizontal_align":"left","font_family":"system-ui","font_size":14,"_events":{}}},"_type":"Group","_events":{}},"99":{"_id":99,"top":330,"left":1010,"width":900,"height":205,"_items":{"87":{"top":30,"left":0,"_id":87,"_type":"Trend","width":900,"height":175,"select_archives":false,"set_period":false,"datasource":"display","series":[{"name":"p_load_fact_smoth","axis":"y"}],"title":"Yearly","border_width":2,"toolbar_visible":"hide","max_points":365,"cycle":24,"_events":{}},"88":{"top":0,"left":0,"_id":88,"_type":"Rectangle","width":120,"height":25,"border_width":0,"transparent":true,"text":"Год","horizontal_align":"left","font_family":"system-ui","font_size":14,"_events":{}}},"_type":"Group","_events":{}},"100":{"top":365,"left":1015,"_id":100,"_type":"TS_Datasource","archives":[{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesS/p_load_sc","name":"p_load_fact","aggregate":"avg"}],"from":"from","to":"to","name":"yearly","step":"minute","step_factor":1,"width":90,"height":35,"z_index":2,"_events":{}},"101":{"top":575,"left":1015,"_id":101,"_type":"TS_Datasource","archives":[{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesS/p_load_sc","name":"p_load_fact","aggregate":"avg"}],"from":"from","to":"to","name":"monthly","step":"minute","step_factor":1,"width":90,"height":35,"z_index":2,"_events":{}},"102":{"top":785,"left":1015,"_id":102,"_type":"TS_Datasource","archives":[{"archive":"/root/PROJECT/TAGS/Nodes/Agadyr_F/u220/archivesS/p_load_sc","name":"p_load_fact","aggregate":"avg"}],"from":"from","to":"to","name":"weekly","step":"minute","step_factor":1,"width":90,"height":35,"z_index":2,"_events":{}},"103":{"top":107,"left":5,"_id":103,"_type":"Rectangle","width":1001,"border_width":3,"border_color":"#bcbcbc","border_style":"ridge","background_color":"#f4f4f4","text":"Прогноз на 36 часов","font_family":"system-ui","font_size":16,"horizontal_align":"left","padding_left":4,"_events":{}},"106":{"top":131,"left":417,"_id":106,"_type":"TableDatasource","height":41,"title":"для выбора нужной папки - архивов.","source_table":"ARCHIVE","_events":{}},"@filter":{"_id":"@filter","_type":"Filter","height":105,"_items":{"20":{"left":54,"_id":20,"_type":"DateTimePicker","z_index":1,"name":"from","top":9,"width":270,"interval":60,"_events":{"init":{"type":"SCRIPT","value":{"script":"function(VARS,element,context){\r    element.set({value: +new Date() - 48 * 3600000});\r    // context.setInterval(()=>{\r    //     element.set({value: +new Date() - 48 * 3600000});\r    // },5000);\r}"}}}},"22":{"left":400,"_id":22,"_type":"DateTimePicker","z_index":1,"name":"to","_links":{"value":{"type":"SCRIPT","tags":{"from":[{"filter":"from"}]},"script":"function(VARS,element,context){\n   \n   return +new Date(VARS.from.get()) + 96 * 3600000;\n}"}},"width":270,"top":9,"_events":{}},"28":{"left":355,"_id":28,"_type":"Rectangle","width":55,"height":35,"z_index":1,"border_width":0,"transparent":true,"text":"по:","font_family":"system-ui","font_size":16,"top":9,"_events":{}},"68":{"left":1044,"_id":68,"_type":"DateTimePicker","z_index":1,"name":"now1","_links":{"value":{"type":"SCRIPT","tags":{"from":[{"filter":"from"}]},"script":"function(VARS,element,context){\n   let d = new Date()\n   console.log(d)\n   //return +new Date(VARS.from.get()) + 96 * 3600000;\n   return d;\n}"}},"width":114,"visible":false,"top":9,"_events":{}},"74":{"left":1214,"_id":74,"_type":"DateTimePicker","z_index":1,"name":"now2","_links":{"value":{"type":"SCRIPT","tags":{"from":[{"filter":"from"}]},"script":"function(VARS,element,context){\n   let d = new Date()\n   console.log(d)\n   //return +new Date(VARS.from.get()) + 96 * 3600000;\n   return d;\n}"}},"width":119,"visible":false,"top":9,"_events":{}},"75":{"_id":75,"_type":"Rectangle","width":55,"height":35,"z_index":1,"border_width":0,"transparent":true,"text":"От:","font_family":"system-ui","font_size":16,"top":9,"left":9,"_events":{}},"78":{"top":56,"left":151,"_id":78,"_type":"Combobox","width":210,"z_index":1,"name":"selector","options":["Агадырь220","Чимкент220"],"_events":{}},"81":{"_id":81,"_type":"Rectangle","width":145,"height":35,"z_index":1,"border_width":0,"transparent":true,"text":"Выбор объекта:","font_family":"system-ui","font_size":16,"top":56,"left":21,"horizontal_align":"left","padding_left":2,"_events":{}},"104":{"top":9,"left":798,"_id":104,"_type":"Combobox","width":70,"z_index":1,"name":"step","options":["час","мин"],"_events":{}},"105":{"_id":105,"_type":"Rectangle","width":109,"height":35,"z_index":1,"border_width":0,"transparent":true,"text":"Выбор шага:","font_family":"system-ui","font_size":16,"top":9,"left":691,"horizontal_align":"left","padding_left":2,"title":"Шаг дискретизации данных трендов","_events":{}}},"border_width":2,"border_color":"#bcbcbc","border_style":"ridge","_events":{}}},"_index":{"5":[],"20":["@filter"],"22":["@filter"],"28":["@filter"],"48":[],"58":[],"59":[],"60":[],"61":[],"62":[],"63":[],"65":[],"68":["@filter"],"72":[],"73":[],"74":["@filter"],"75":["@filter"],"76":[],"77":[],"78":["@filter"],"81":["@filter"],"82":[],"83":[],"87":[99],"88":[99],"92":[98],"93":[98],"95":[],"96":[95],"97":[95],"98":[],"99":[],"100":[],"101":[],"102":[],"103":[],"104":["@filter"],"105":["@filter"],"106":[],"@filter":[]},"background_color":"#f4f4f4","border_width":2,"border_color":"#bcbcbc","border_style":"ridge","_events":{}}